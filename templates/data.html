<!-- Inside your <body> -->
<div class="left-panel">
    <!-- Overall Table -->
    <div>
        <div id="overallLoadingSpinner" class="spinner"></div>
        <div id="overallTableContainer" class="flex-grow"></div>
    </div>

    <!-- Projections Table -->
    <div>
        <div id="projectionsLoadingSpinner" class="spinner"></div>
        <div id="projectionsTableContainer" class="flex-grow"></div>
    </div>
</div>

<!-- Refresh Button -->
<button id="refreshAllButton" class="refresh-button">Refresh All Data</button>

<!-- Script below -->
<script>
    async function fetchSheetData(sheetName, dataRange) {
        try {
            const BASE_API_URL = ''; // ðŸ” Replace this with your backend URL if needed
            const url = `${BASE_API_URL}/get_sheet_data?sheet_name=${encodeURIComponent(sheetName)}&range_name=${encodeURIComponent(dataRange)}`;
            console.log(`Fetching data from: ${url}`);
            const response = await fetch(url);
            const data = await response.json();

            if (response.ok) {
                return { status: 'ready', data: data.values, sheetName };
            } else {
                return { status: 'error', message: data.message || `Failed to fetch ${sheetName}.` };
            }
        } catch (error) {
            console.error(`Fetch error for ${sheetName}:`, error);
            return { status: 'error', message: `Network/server error for ${sheetName}` };
        }
    }

    function renderTable(containerId, sheetData, sheetTitle) {
        const container = document.getElementById(containerId);
        const spinner = document.getElementById(containerId.replace('TableContainer', 'LoadingSpinner'));
        container.innerHTML = '';
        if (spinner) spinner.style.display = 'none';

        if (!sheetData || sheetData.length === 0) return;

        const table = document.createElement('table');
        table.classList.add('min-w-full');
        const thead = document.createElement('thead');
        const tbody = document.createElement('tbody');

        if (containerId === 'overallTableContainer' || containerId === 'projectionsTableContainer') {
            const headerRow = document.createElement('tr');
            const th1 = document.createElement('th');
            th1.textContent = sheetTitle;
            headerRow.appendChild(th1);
            const th2 = document.createElement('th');
            th2.textContent = 'Value';
            headerRow.appendChild(th2);
            thead.appendChild(headerRow);
            table.appendChild(thead);

            sheetData.forEach(row => {
                if (row.length >= 2) {
                    const tr = document.createElement('tr');
                    const td1 = document.createElement('td');
                    td1.textContent = row[0];
                    const td2 = document.createElement('td');
                    td2.textContent = row[1];
                    tr.appendChild(td1);
                    tr.appendChild(td2);
                    tbody.appendChild(tr);
                }
            });
        } else {
            // For Annual / Quarterly dynamic headers
            const headerRow = document.createElement('tr');
            (sheetData[0] || []).forEach(col => {
                const th = document.createElement('th');
                th.textContent = col;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            for (let i = 1; i < sheetData.length; i++) {
                const tr = document.createElement('tr');
                (sheetData[i] || []).forEach(val => {
                    const td = document.createElement('td');
                    td.textContent = val || '';
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            }
        }

        table.appendChild(tbody);
        container.appendChild(table);
    }

    async function loadAllSheetData() {
        document.getElementById('overallLoadingSpinner').style.display = 'block';
        document.getElementById('projectionsLoadingSpinner').style.display = 'block';
        document.getElementById('annualLoadingSpinner').style.display = 'block';
        document.getElementById('quarterlyLoadingSpinner').style.display = 'block';
        document.getElementById('refreshAllButton').style.display = 'none';

        try {
            const [overall, projections, annual, quarterly] = await Promise.all([
                fetchSheetData('Overall', 'A:B'),
                fetchSheetData('Projections Data', 'A:B'),
                fetchSheetData('Annual Data', 'A:Z'),
                fetchSheetData('Quarterly Data', 'A:Z')
            ]);

            if (overall.status === 'ready') renderTable('overallTableContainer', overall.data, 'Overall');
            if (projections.status === 'ready') renderTable('projectionsTableContainer', projections.data, 'Projections');
            if (annual.status === 'ready') renderTable('annualTableContainer', annual.data, 'Annual');
            if (quarterly.status === 'ready') renderTable('quarterlyTableContainer', quarterly.data, 'Quarterly');

        } catch (err) {
            console.error("Loading error:", err);
        } finally {
            ['overall', 'projections', 'annual', 'quarterly'].forEach(id => {
                const spinner = document.getElementById(`${id}LoadingSpinner`);
                if (spinner) spinner.style.display = 'none';
            });
            document.getElementById('refreshAllButton').style.display = 'block';
        }
    }

    // Load once on page load
    window.onload = loadAllSheetData;

    // Refresh button handler
    document.getElementById('refreshAllButton').addEventListener('click', loadAllSheetData);
</script>
